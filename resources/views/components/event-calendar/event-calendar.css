.spire-event-calendar {
    --event-calendar-border: var(--color-border);
    --event-calendar-bg: var(--color-surface);
    --event-calendar-header-bg: var(--color-surface);
    --event-calendar-day-bg: var(--color-surface);
    --event-calendar-day-hover: var(--color-hover);
    --event-calendar-today-bg: var(--color-primary-lighter);
    --event-calendar-outside-opacity: 0.4;
    --event-calendar-weekend-bg: var(--color-surface-alt);

    display: flex;
    flex-direction: column;
    background: var(--event-calendar-bg);
    border: 1px solid var(--event-calendar-border);
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.spire-event-calendar__header {
    @apply flex items-center justify-between px-6 py-4;
    background: var(--event-calendar-header-bg);
    border-bottom: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__header-title {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.spire-event-calendar__month-year {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-text);
    margin: 0;
    display: flex;
    gap: var(--spacing-1);
}

.spire-event-calendar__header-nav {
    display: flex;
    align-items: center;
    gap: var(--spacing-2);
}

.spire-event-calendar__header-arrows {
    display: flex;
    align-items: center;
    gap: var(--spacing-1);
}

.spire-event-calendar__month-view {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.spire-event-calendar__day-names {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    border-bottom: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__day-name {
    padding: var(--spacing-2) var(--spacing-1);
    text-align: center;
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.spire-event-calendar__grid {
    display: flex;
    flex-direction: column;
    flex: 1;
}

.spire-event-calendar__week {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    flex: 1;
    min-height: 100px;
}

.spire-event-calendar__week:not(:last-child) {
    border-bottom: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__day-cell {
    display: flex;
    flex-direction: column;
    padding: var(--spacing-1);
    background: var(--event-calendar-day-bg);
    cursor: pointer;
    transition: background-color 0.15s ease;
    min-height: 100px;
}

.spire-event-calendar__day-cell:not(:last-child) {
    border-right: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__day-cell:hover {
    background: var(--event-calendar-day-hover);
}

.spire-event-calendar__day-cell--outside {
    opacity: var(--event-calendar-outside-opacity);
}

.spire-event-calendar__day-cell--today {
    background: var(--event-calendar-today-bg);
}

.spire-event-calendar__day-cell--today:hover {
    background: var(--event-calendar-today-bg);
}

.spire-event-calendar__day-cell--weekend {
    background: var(--event-calendar-weekend-bg);
}

.spire-event-calendar__day-header {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: var(--spacing-1);
}

.spire-event-calendar__day-number {
    font-size: var(--text-sm);
    font-weight: var(--font-medium);
    color: var(--color-text);
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: var(--radius-full);
}

.spire-event-calendar__day-number--today {
    background: var(--color-primary);
    color: var(--color-primary-contrast);
}

.spire-event-calendar__day-events {
    display: flex;
    flex-direction: column;
    gap: 2px;
    flex: 1;
    overflow: hidden;
    justify-content: flex-end;
}

.spire-event-calendar__event {
    @apply flex items-center gap-1.5 px-2 py-1.5 rounded-md text-xs;
    @apply transition-all duration-200 ease-out;
    text-align: left;
    cursor: pointer;
    background: color-mix(in srgb, var(--event-color, var(--color-primary)) 12%, transparent);
    border: none;
    border-left: 2px solid var(--event-color, var(--color-primary));
    width: 100%;
    overflow: hidden;
    animation: eventFadeSlideIn 0.2s ease-out both;
}

.spire-event-calendar__event:hover {
    @apply -translate-y-0.5 shadow-sm;
}

.spire-event-calendar__event--all-day {
    @apply rounded-lg shadow-sm;
    background: var(--event-color, var(--color-primary));
    color: white;
    border-left: none;
}

.spire-event-calendar__event--all-day:hover {
    @apply scale-[1.02] shadow-md -translate-y-0;
}

.spire-event-calendar__event--all-day .spire-event-calendar__event-dot {
    display: none;
}

.spire-event-calendar__event-dot {
    width: 6px;
    height: 6px;
    border-radius: var(--radius-full);
    background: var(--event-color, var(--color-primary));
    flex-shrink: 0;
}

.spire-event-calendar__event-time {
    font-weight: var(--font-medium);
    color: var(--color-text-muted);
    flex-shrink: 0;
}

.spire-event-calendar__event--all-day .spire-event-calendar__event-time {
    color: inherit;
    opacity: 0.8;
}

.spire-event-calendar__event-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--color-text);
}

.spire-event-calendar__event--all-day .spire-event-calendar__event-title {
    color: inherit;
}

.spire-event-calendar__more-btn {
    display: flex;
    align-items: center;
    padding: 2px var(--spacing-1);
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--color-text-muted);
    background: none;
    border: none;
    cursor: pointer;
    border-radius: var(--radius-sm);
    transition: background-color 0.15s ease, color 0.15s ease;
}

.spire-event-calendar__more-btn:hover {
    background: var(--color-hover);
    color: var(--color-text);
}

.spire-event-calendar__more-popover {
    position: absolute;
    z-index: 50;
    min-width: 200px;
    max-width: 300px;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
}

.spire-event-calendar__more-popover-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-3);
    border-bottom: 1px solid var(--color-border);
}

.spire-event-calendar__more-popover-date {
    font-size: var(--text-sm);
    font-weight: var(--font-semibold);
    color: var(--color-text);
}

.spire-event-calendar__more-popover-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    background: none;
    border: none;
    border-radius: var(--radius-sm);
    color: var(--color-text-muted);
    cursor: pointer;
    transition: background-color 0.15s ease, color 0.15s ease;
}

.spire-event-calendar__more-popover-close:hover {
    background: var(--color-hover);
    color: var(--color-text);
}

.spire-event-calendar__more-popover-events {
    padding: var(--spacing-2);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-1);
    max-height: 300px;
    overflow-y: auto;
}

.spire-event-calendar__day-custom {
    margin-top: auto;
    padding-top: var(--spacing-1);
}

/* ===== Day Button (Keyboard Accessible) ===== */

.spire-event-calendar__day-button {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0;
    background: none;
    border: none;
    cursor: pointer;
    width: 100%;
    border-radius: var(--radius-sm);
}

.spire-event-calendar__day-button:focus {
    outline: 2px solid var(--color-primary);
    outline-offset: -2px;
}

.spire-event-calendar__day-button:focus:not(:focus-visible) {
    outline: none;
}

.spire-event-calendar__day-button:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: -2px;
}

/* ===== Focus Styles ===== */

.spire-event-calendar__event:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 1px;
}

.spire-event-calendar__more-btn:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 1px;
}

/* ===== Screen Reader Only ===== */

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* ===== Spanning Events ===== */

.spire-event-calendar__week {
    position: relative;
}

.spire-event-calendar__spanning-events {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 2;
}

.spire-event-calendar__spanning-event {
    @apply absolute flex items-center text-xs font-medium shadow-sm rounded-md px-3;
    @apply transition-all duration-200 ease-out;
    height: 22px;
    background: var(--event-color, var(--color-primary));
    color: white;
    cursor: pointer;
    pointer-events: auto;
    border: none;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    animation: eventFadeSlideIn 0.25s ease-out both;
}

.spire-event-calendar__spanning-event:hover {
    @apply shadow-md brightness-105;
}

.spire-event-calendar__spanning-event:focus-visible {
    outline: 2px solid var(--color-primary-contrast);
    outline-offset: -2px;
}

.spire-event-calendar__spanning-event--start {
    @apply rounded-l-lg;
}

.spire-event-calendar__spanning-event--end {
    @apply rounded-r-lg;
}

.spire-event-calendar__spanning-event-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.spire-event-calendar__spanning-spacer {
    height: calc(var(--spanning-slots, 0) * 24px);
    flex-shrink: 0;
    min-height: 0;
}

/* ===== View Switcher ===== */

.spire-event-calendar__view-switcher {
    display: flex;
    align-items: center;
}

/* ===== Time Grid Shared Styles ===== */

.spire-event-calendar__time-grid-container {
    display: flex;
    flex: 1;
    overflow: auto;
    position: relative;
}

.spire-event-calendar__time-axis {
    @apply shrink-0;
    width: 72px;
    border-right: 1px solid var(--event-calendar-border);
    background: var(--event-calendar-header-bg);
}

.spire-event-calendar__time-axis-header {
    height: 60px;
    border-bottom: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__time-label {
    @apply flex items-start justify-end px-3 py-2 text-xs font-medium;
    height: var(--time-slot-height, 60px);
    color: var(--color-text-muted);
    border-bottom: 1px solid var(--event-calendar-border);
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.01em;
}

.spire-event-calendar__day-columns {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 0;
}

.spire-event-calendar__day-headers {
    display: flex;
    border-bottom: 1px solid var(--event-calendar-border);
    background: var(--event-calendar-header-bg);
}

.spire-event-calendar__day-header-cell {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-2);
    min-height: 60px;
    border-right: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__day-header-cell:last-child {
    border-right: none;
}

.spire-event-calendar__day-header-cell--today {
    background: var(--event-calendar-today-bg);
}

.spire-event-calendar__day-name-label {
    font-size: var(--text-xs);
    font-weight: var(--font-medium);
    color: var(--color-text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.spire-event-calendar__day-date-label {
    font-size: var(--text-lg);
    font-weight: var(--font-semibold);
    color: var(--color-text);
}

.spire-event-calendar__day-date-label--today {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-primary);
    color: var(--color-primary-contrast);
    border-radius: var(--radius-full);
}

.spire-event-calendar__time-grid {
    display: flex;
    flex: 1;
    position: relative;
}

.spire-event-calendar__time-column {
    flex: 1;
    position: relative;
    border-right: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__time-column:last-child {
    border-right: none;
}

.spire-event-calendar__time-slot {
    height: var(--time-slot-height, 60px);
    border-bottom: 1px solid var(--event-calendar-border);
    cursor: pointer;
    transition: background-color 0.15s ease;
}

.spire-event-calendar__time-slot:hover {
    background: var(--event-calendar-day-hover);
}

.spire-event-calendar__time-events {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

/* ===== Positioned Time Events ===== */

.spire-event-calendar__time-event-wrapper {
    @apply absolute block;
    pointer-events: auto;
}

.spire-event-calendar__time-event {
    @apply relative flex flex-col gap-0.5 p-1.5 rounded-md text-xs w-full h-full;
    @apply transition-all duration-200 ease-out;
    margin: 0 2px;
    text-align: left;
    cursor: pointer;
    overflow: hidden;
    background: color-mix(in srgb, var(--event-color, var(--color-primary)) 15%, var(--color-surface));
    border-left: 2px solid var(--event-color, var(--color-primary));
    border-top: none;
    border-right: none;
    border-bottom: none;
    animation: eventFadeSlideIn 0.2s ease-out both;
}

.spire-event-calendar__time-event:hover {
    @apply scale-[1.01] shadow-sm;
}

.spire-event-calendar__time-event:focus-visible {
    outline: 2px solid var(--color-primary);
    outline-offset: 1px;
}

.spire-event-calendar__time-event-time {
    font-weight: var(--font-medium);
    color: var(--color-text);
    font-size: 10px;
}

.spire-event-calendar__time-event-title {
    font-weight: var(--font-medium);
    color: var(--color-text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* ===== Now Indicator ===== */

.spire-event-calendar__now-indicator {
    position: absolute;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--color-danger);
    z-index: 10;
    pointer-events: none;
}

.spire-event-calendar__now-indicator::before {
    content: '';
    position: absolute;
    left: -5px;
    top: -4px;
    width: 10px;
    height: 10px;
    background: var(--color-danger);
    border-radius: var(--radius-full);
}

/* ===== All-Day Events Row ===== */

.spire-event-calendar__all-day-row {
    display: flex;
    border-bottom: 1px solid var(--event-calendar-border);
    background: var(--event-calendar-header-bg);
    min-height: 32px;
}

.spire-event-calendar__all-day-label {
    @apply shrink-0 flex items-center justify-end px-3 py-1 text-xs;
    width: 72px;
    color: var(--color-text-muted);
    border-right: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__all-day-events {
    display: flex;
    flex: 1;
    padding: var(--spacing-1) 0;
    gap: 1px;
}

.spire-event-calendar__all-day-cell {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 2px;
    padding: 0 var(--spacing-1);
    border-right: 1px solid var(--event-calendar-border);
}

.spire-event-calendar__all-day-cell:last-child {
    border-right: none;
}

.spire-event-calendar__all-day-cell--single {
    flex-direction: row;
    flex-wrap: wrap;
}

.spire-event-calendar__all-day-event {
    @apply block px-2 py-1 text-xs font-medium rounded-lg shadow-sm;
    @apply transition-all duration-200 ease-out;
    color: white;
    background: var(--event-color, var(--color-primary));
    border: none;
    cursor: pointer;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    animation: eventFadeSlideIn 0.2s ease-out both;
}

.spire-event-calendar__all-day-event:hover {
    @apply scale-[1.02] shadow-md brightness-105;
}

.spire-event-calendar__all-day-event:focus-visible {
    outline: 2px solid var(--color-primary-contrast);
    outline-offset: -2px;
}

/* ===== Week View ===== */

.spire-event-calendar__week-view {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 500px;
}

/* ===== Day View ===== */

.spire-event-calendar__day-view {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-height: 500px;
}

.spire-event-calendar__day-view-header {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-3);
    border-bottom: 1px solid var(--event-calendar-border);
    background: var(--event-calendar-header-bg);
}

.spire-event-calendar__day-view-date {
    font-size: var(--text-xl);
    font-weight: var(--font-semibold);
    color: var(--color-text);
}

.spire-event-calendar__day-view-date--today {
    color: var(--color-primary);
}

.spire-event-calendar__time-grid-container--single .spire-event-calendar__time-column {
    border-right: none;
}

/* Fix for day view - ensure the wrapper div takes full space */
.spire-event-calendar__time-grid-container--single .spire-event-calendar__time-grid {
    @apply flex-1;
}

.spire-event-calendar__time-grid-container--single .spire-event-calendar__time-grid > div {
    @apply flex-1 flex;
}

@media (max-width: 640px) {
    .spire-event-calendar {
        --time-slot-height: 48px;
    }

    .spire-event-calendar__header {
        @apply flex-col gap-2 px-4 py-3;
    }

    .spire-event-calendar__month-year {
        font-size: var(--text-base);
    }

    .spire-event-calendar__day-cell {
        min-height: 60px;
    }

    .spire-event-calendar__day-name {
        font-size: 10px;
    }

    .spire-event-calendar__event {
        @apply py-2;
        min-height: 32px;
    }

    .spire-event-calendar__event-time {
        display: none;
    }

    .spire-event-calendar__time-axis {
        width: 56px;
    }

    .spire-event-calendar__all-day-label {
        width: 56px;
    }


    .spire-event-calendar__time-event-time {
        display: none;
    }

    .spire-event-calendar__day-header-cell {
        min-height: 48px;
        padding: var(--spacing-1);
    }

    .spire-event-calendar__day-date-label {
        font-size: var(--text-base);
    }

    .spire-event-calendar__view-switcher {
        display: none !important;
    }
}

/* ===== Event Entrance Animation ===== */

@keyframes eventFadeSlideIn {
    from {
        opacity: 0;
        transform: translateY(4px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Stagger animations for multiple events */
.spire-event-calendar__day-events .spire-event-calendar__event:nth-child(1) { animation-delay: 0ms; }
.spire-event-calendar__day-events .spire-event-calendar__event:nth-child(2) { animation-delay: 50ms; }
.spire-event-calendar__day-events .spire-event-calendar__event:nth-child(3) { animation-delay: 100ms; }

.spire-event-calendar__spanning-events .spire-event-calendar__spanning-event:nth-child(1) { animation-delay: 0ms; }
.spire-event-calendar__spanning-events .spire-event-calendar__spanning-event:nth-child(2) { animation-delay: 75ms; }
.spire-event-calendar__spanning-events .spire-event-calendar__spanning-event:nth-child(3) { animation-delay: 150ms; }

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
    .spire-event-calendar__event,
    .spire-event-calendar__spanning-event,
    .spire-event-calendar__time-event,
    .spire-event-calendar__all-day-event {
        animation: none;
    }
}
